<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Account Statement</title>

<style>

@page {
  size: A4;
  margin: 18mm 15mm;
}

body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #ffffff;
  margin: 0;
  color: #1C1C1C;
}

.statement {
  max-width: 900px;
  margin: auto;
}

/* ================= HEADER ================= */

.header {
  border-bottom: 3px solid #0F1B2A;
  padding-bottom: 18px;
  margin-bottom: 30px;
}

.header-title {
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 1px;
  color: #0F1B2A;
  text-transform: uppercase;
}

.header-sub {
  font-size: 13px;
  color: #6B7280;
  margin-top: 4px;
}

/* ================= CLIENT INFO ================= */

.client-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-bottom: 30px;
  font-size: 13px;
}

.client-block h4 {
  font-size: 11px;
  text-transform: uppercase;
  color: #6B7280;
  margin-bottom: 6px;
  letter-spacing: .5px;
}

.client-block p {
  margin: 2px 0;
  font-weight: 500;
}

/* ================= SECTION HEADINGS ================= */

.section-title {
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .8px;
  color: #0F1B2A;
  margin: 35px 0 12px;
  border-bottom: 1px solid #D9DEE5;
  padding-bottom: 6px;
}

/* ================= TABLE ================= */

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

thead {
  background: #F5F7FA;
}

th {
  text-align: center;
  padding: 10px 8px;
  font-weight: 600;
  border-bottom: 1px solid #D9DEE5;
  text-transform: uppercase;
  font-size: 11px;
  letter-spacing: .4px;
}

td {
  padding: 9px 8px;
  border-bottom: 1px solid #E5E7EB;
  vertical-align: middle;
}

.numeric {
  text-align: center;
  font-variant-numeric: tabular-nums;
}

.center {
  text-align: center;
}

/* Positive / Negative P&L */

.positive {
  color: #0A7A3E;
  font-weight: 600;
}

.negative {
  color: #B42318;
  font-weight: 600;
}

/* ================= FOOTER ================= */

.footer {
  margin-top: 40px;
  font-size: 11px;
  color: #6B7280;
  border-top: 1px solid #D9DEE5;
  padding-top: 12px;
  line-height: 1.5;
}

/* ================= PRINT CONTROL ================= */

@media print {
  body {
    margin: 0;
  }

  tr {
    page-break-inside: avoid;
  }

  thead {
    display: table-header-group;
  }
}

</style>
</head>
<body>

<div class="statement">

  <!-- HEADER -->
  <div class="header">
    <div class="header-title">VTIndex Account Statement</div>
    <div class="header-sub">{{ report_month }}</div>
  </div>

  <!-- CLIENT INFO -->
  <div class="client-grid">

    <div class="client-block">
      <h4>Client Information</h4>
      <p><strong>{{ client_name }}</strong></p>
      <p>{{ address }}</p>
      <p>{{ phone }}</p>
    </div>

    <div class="client-block">
      <h4>Account Details</h4>
      <p>Account ID: {{ account_id }}</p>
      <p>Account Type: {{ account_type }}</p>
      <p>Statement Date: {{ report_date }}</p>
    </div>

  </div>

  <!-- ACCOUNT SUMMARY -->
  <div class="section-title">Account Summary</div>

  <table>
    <thead>
      <tr>
        <th>Starting Balance</th>
        <th>Ending Balance</th>
        <th>Total P/L</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="numeric">${{ starting_balance|floatformat:2 }}</td>
        <td class="numeric">${{ ending_balance|floatformat:2 }}</td>
        <td class="numeric {% if total_pnl >= 0 %}positive{% else %}negative{% endif %}">
          ${{ total_pnl|floatformat:2 }}
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ACCOUNT TRANSACTIONS (Summary: grouped per-account; Per-account: account-specific) -->
  {% if is_summary %}
  <div class="section-title">Account Transactions</div>
  {% if transactions_by_account and transactions_by_account.items %}
    {% for acc_id, rows in transactions_by_account.items %}
      <h4 style="margin-top:12px; margin-bottom:6px;">Account: {{ acc_id }}</h4>
      {% if rows|length == 0 %}
        <p>No transactions for this account.</p>
      {% else %}
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th class="numeric">Credit</th>
              <th class="numeric">Debit</th>
              <th class="numeric">Available</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {% for t in rows %}
            <tr>
              <td>{{ t.date }}</td>
              <td class="numeric">{{ t.credit }}</td>
              <td class="numeric">{{ t.debit }}</td>
              <td class="numeric">{{ t.available }}</td>
              <td>{{ t.description }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    {% endfor %}
  {% else %}
    <p>No transactions found for any account.</p>
  {% endif %}
  {% else %}
    {% if transactions and transactions|length > 0 %}
      <div class="section-title">Account Transactions</div>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th class="numeric">Credit</th>
            <th class="numeric">Debit</th>
            <th class="numeric">Available</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          {% for t in transactions %}
          <tr>
            <td>{{ t.date }}</td>
            <td class="numeric">{{ t.credit }}</td>
            <td class="numeric">{{ t.debit }}</td>
            <td class="numeric">{{ t.available }}</td>
            <td>{{ t.description }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  {% endif %}

  {% if trades|length > 0 %}
  <!-- TRADE HISTORY -->
  <div class="section-title">Trade History</div>

  <table>
    <thead>
      <tr>
        <th>Open Time</th>
        <th>Close Time</th>
        <th>Symbol</th>
        <th>Type</th>
        <th class="numeric">Volume</th>
        <th class="numeric">P/L</th>
        <th class="center">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for trade in trades %}
      <tr>
        <td>{{ trade.open_time }}</td>
        <td>{{ trade.close_time }}</td>
        <td>{{ trade.symbol }}</td>
        <td>{{ trade.type }}</td>
        <td class="numeric">{{ trade.volume }}</td>
        <td class="numeric {% if trade.profit >= 0 %}positive{% else %}negative{% endif %}">
          ${{ trade.profit|floatformat:2 }}
        </td>
        <td class="center">
          {% if trade.close_time == "Open" or not trade.close_time %}
            Open
          {% else %}
            Closed
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <!-- FOOTER -->
  <div class="footer">
    This statement is confidential and intended solely for the named recipient.
    Trading involves substantial risk and may not be suitable for all investors.
    Past performance does not guarantee future results.
    For discrepancies, please contact support@vtindex.com.
  </div>

</div>

</body>
</html>
